<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时天气信息</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .weather-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            transform: scale(0.8);
            transform-origin: center;
        }

        .weather-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding-bottom: 15px;
        }

        .weather-header h1 {
            color: #333;
            font-weight: 600;
            font-size: 28px;
        }

        .weather-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
        }

        /* 加载状态样式 */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        .loading-text {
            font-size: 16px;
            color: #667eea;
            font-weight: 500;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 错误状态样式 */
        .error {
            text-align: center;
            padding: 30px;
            color: #dc3545;
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .error-text {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .error-desc {
            font-size: 14px;
            color: #6c757d;
        }

        /* 天气信息样式 */
        .weather-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .weather-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .card-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .card-value {
            font-size: 22px;
            color: #333;
            font-weight: 600;
        }

        .city-info {
            text-align: center;
            margin-bottom: 30px;
        }

        .city-name {
            font-size: 24px;
            color: #333;
            font-weight: 600;
        }

        .report-time {
            font-size: 14px;
            color: #6c757d;
            margin-top: 5px;
        }

        .weather-desc {
            font-size: 20px;
            color: #667eea;
            font-weight: 500;
            text-align: center;
            margin: 10px 0 20px;
        }

        /* 响应式设计 */
        @media (max-width: 480px) {
            .weather-container {
                padding: 25px 20px;
                transform: scale(0.9);
            }

            .weather-header h1 {
                font-size: 22px;
            }

            .weather-card {
                padding: 15px;
            }

            .card-value {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="weather-container">
        <div class="weather-header">
            <h1>实时天气信息</h1>
        </div>

        <!-- 加载状态 -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">正在获取天气数据...</div>
        </div>

        <!-- 错误状态 -->
        <div id="error" class="error" style="display: none;">
            <div class="error-icon">❌</div>
            <div class="error-text" id="errorText">获取天气数据失败</div>
            <div class="error-desc" id="errorDesc">请稍后重试</div>
        </div>

        <!-- 天气数据展示区域 -->
        <div id="weatherContent" style="display: none;">
            <div class="city-info">
                <div class="city-name" id="cityName"></div>
                <div class="report-time" id="reportTime"></div>
            </div>
            
            <div class="weather-desc" id="weatherDesc"></div>
            
            <div class="weather-info">
                <div class="weather-card">
                    <div class="card-label">温度</div>
                    <div class="card-value" id="temperature">--</div>
                </div>
                <div class="weather-card">
                    <div class="card-label">湿度</div>
                    <div class="card-value" id="humidity">--</div>
                </div>
                <div class="weather-card">
                    <div class="card-label">风向</div>
                    <div class="card-value" id="windDirection">--</div>
                </div>
                <div class="weather-card">
                    <div class="card-label">风力</div>
                    <div class="card-value" id="windPower">--</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM元素获取
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const weatherContentEl = document.getElementById('weatherContent');
        const errorTextEl = document.getElementById('errorText');
        const errorDescEl = document.getElementById('errorDesc');
        
        // 天气数据展示元素
        const cityNameEl = document.getElementById('cityName');
        const reportTimeEl = document.getElementById('reportTime');
        const weatherDescEl = document.getElementById('weatherDesc');
        const temperatureEl = document.getElementById('temperature');
        const humidityEl = document.getElementById('humidity');
        const windDirectionEl = document.getElementById('windDirection');
        const windPowerEl = document.getElementById('windPower');

        // 配置项 - 修改此处为你的后端接口地址
        const API_CONFIG = {
            // 替换为实际的后端接口URL
            url: '/api/weather', 
            // 请求方式 (GET/POST)
            method: 'GET',      
            // 请求头（根据后端要求调整）
            headers: {
                'Content-Type': 'application/json'
            }
        };

        /**
         * 初始化页面：请求后端JSON数据并渲染
         */
        async function initWeatherPage() {
            try {
                // 1. 请求后端接口获取JSON数据
                const response = await fetch(API_CONFIG.url, {
                    method: API_CONFIG.method,
                    headers: API_CONFIG.headers
                });

                // 2. 检查HTTP响应状态
                if (!response.ok) {
                    throw new Error(`HTTP请求失败: ${response.status} ${response.statusText}`);
                }

                // 3. 解析JSON数据（核心：仅解析后端返回的JSON）
                const jsonData = await response.json();
                console.log('后端返回的JSON数据:', jsonData);

                // 4. 验证JSON数据结构有效性
                validateWeatherData(jsonData);

                // 5. 渲染JSON数据到页面
                renderWeatherData(jsonData.lives[0]);

                // 6. 切换到成功状态
                loadingEl.style.display = 'none';
                errorEl.style.display = 'none';
                weatherContentEl.style.display = 'block';

            } catch (error) {
                // 异常处理：显示错误信息
                console.error('数据处理失败:', error);
                loadingEl.style.display = 'none';
                weatherContentEl.style.display = 'none';
                errorEl.style.display = 'block';
                
                // 显示错误详情
                errorTextEl.textContent = error.message || '解析数据失败';
                errorDescEl.textContent = error.cause || '请检查后端接口返回格式';
            }
        }

        /**
         * 验证后端返回的JSON数据结构
         * @param {Object} data 后端返回的JSON对象
         */
        function validateWeatherData(data) {
            // 检查核心字段是否存在
            const requiredFields = ['status', 'lives'];
            const missingFields = requiredFields.filter(field => !data.hasOwnProperty(field));
            
            if (missingFields.length > 0) {
                throw new Error('后端返回数据结构不完整', {
                    cause: `缺失字段: ${missingFields.join(', ')}`
                });
            }

            // 检查状态是否成功
            if (data.status !== '1') {
                throw new Error('后端返回错误状态', {
                    cause: `info: ${data.info || '未知错误'}, infocode: ${data.infocode || '无'}`
                });
            }

            // 检查lives数组是否有数据
            if (!Array.isArray(data.lives) || data.lives.length === 0) {
                throw new Error('天气数据为空', { cause: 'lives数组为空' });
            }

            // 检查lives第一项的核心字段
            const liveData = data.lives[0];
            const liveRequiredFields = ['province', 'city', 'weather', 'temperature', 'humidity', 'winddirection', 'windpower', 'reporttime'];
            const liveMissingFields = liveRequiredFields.filter(field => !liveData.hasOwnProperty(field));
            
            if (liveMissingFields.length > 0) {
                throw new Error('天气详情数据不完整', {
                    cause: `缺失字段: ${liveMissingFields.join(', ')}`
                });
            }
        }

        /**
         * 将JSON数据渲染到页面
         * @param {Object} weatherData lives数组中的单条天气数据
         */
        function renderWeatherData(weatherData) {
            // 渲染城市信息
            cityNameEl.textContent = `${weatherData.province} ${weatherData.city}`;
            reportTimeEl.textContent = `数据更新时间: ${weatherData.reporttime}`;
            
            // 渲染天气状况
            weatherDescEl.textContent = weatherData.weather;
            
            // 渲染具体气象数据（带单位）
            temperatureEl.textContent = `${weatherData.temperature}°C`;
            humidityEl.textContent = `${weatherData.humidity}%`;
            windDirectionEl.textContent = weatherData.winddirection;
            windPowerEl.textContent = `${weatherData.windpower}级`;
        }

        // 页面加载完成后自动执行
        document.addEventListener('DOMContentLoaded', function() {
            initWeatherPage();
        });
    </script>
</body>
</html>